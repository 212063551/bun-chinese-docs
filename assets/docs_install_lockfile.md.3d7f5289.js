import{_ as s,o as a,c as l,Q as n}from"./chunks/framework.400dfe9a.js";const b=JSON.parse('{"title":"锁定文件","description":"","frontmatter":{},"headers":[],"relativePath":"docs/install/lockfile.md","filePath":"docs/install/lockfile.md","lastUpdated":1696598272000}'),o={name:"docs/install/lockfile.md"},p=n(`<h1 id="锁定文件" tabindex="-1">锁定文件 <a class="header-anchor" href="#锁定文件" aria-label="Permalink to &quot;锁定文件&quot;">​</a></h1><p>运行 <code>bun install</code> 将创建一个名为 <code>bun.lockb</code> 的二进制锁文件。</p><h2 id="为什么是二进制的" tabindex="-1">为什么是二进制的？ <a class="header-anchor" href="#为什么是二进制的" aria-label="Permalink to &quot;为什么是二进制的？&quot;">​</a></h2><p>总而言之性能很好, Bun 的 lockfile 保存和加载速度非常快，并且比通常在 lockfiles 中保存更多的数据。</p><h2 id="如何检查-bun-的-lockfile" tabindex="-1">如何检查 Bun 的 lockfile？ <a class="header-anchor" href="#如何检查-bun-的-lockfile" aria-label="Permalink to &quot;如何检查 Bun 的 lockfile？&quot;">​</a></h2><p>运行 bun install -y 以生成可以更容易地检查的与 yarn 兼容的 Yarn.lock (v1)。</p><h2 id="我如何-git-diff-bun-的-lockfile" tabindex="-1">我如何 git diff Bun 的 lockfile？ <a class="header-anchor" href="#我如何-git-diff-bun-的-lockfile" aria-label="Permalink to &quot;我如何 git diff Bun 的 lockfile？&quot;">​</a></h2><p>将以下内容添加到本地或全局.gittributes 文件中：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark has-diff vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">*.lockb binary diff=lockb</span></span></code></pre><pre class="shiki github-light has-diff vp-code-light"><code><span class="line"><span style="color:#24292e;">*.lockb binary diff=lockb</span></span></code></pre></div><p>然后将以下内容添加到您的本地 git 配置中:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark has-diff vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">git</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">config</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">diff.lockb.textconv</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">bun</span></span>
<span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">git</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">config</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">diff.lockb.binary</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">true</span></span></code></pre><pre class="shiki github-light has-diff vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">git</span><span style="color:#24292E;"> </span><span style="color:#032F62;">config</span><span style="color:#24292E;"> </span><span style="color:#032F62;">diff.lockb.textconv</span><span style="color:#24292E;"> </span><span style="color:#032F62;">bun</span></span>
<span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">git</span><span style="color:#24292E;"> </span><span style="color:#032F62;">config</span><span style="color:#24292E;"> </span><span style="color:#032F62;">diff.lockb.binary</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">true</span></span></code></pre></div><p>或使用--global 选项添加到您的全局 git 配置(系统范围)：</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark has-diff vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">git</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">config</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--global</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">diff.lockb.textconv</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">bun</span></span>
<span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">git</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">config</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--global</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">diff.lockb.binary</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">true</span></span></code></pre><pre class="shiki github-light has-diff vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">git</span><span style="color:#24292E;"> </span><span style="color:#032F62;">config</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--global</span><span style="color:#24292E;"> </span><span style="color:#032F62;">diff.lockb.textconv</span><span style="color:#24292E;"> </span><span style="color:#032F62;">bun</span></span>
<span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">git</span><span style="color:#24292E;"> </span><span style="color:#032F62;">config</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--global</span><span style="color:#24292E;"> </span><span style="color:#032F62;">diff.lockb.binary</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">true</span></span></code></pre></div><p>为什么这样做：</p><ul><li><code>textconv</code> 告诉 git 在对比文件之前运行 bun</li><li><code>binary</code> 告诉 git 将文件视为二进制文件 (因此它不会尝试逐行比较)</li></ul><p>在锁定文件上运行 Bun 将打印出人类可读的区别。因此，我们只需要告诉 git 在对锁定文件进行区分之前运行 Bun。</p><h2 id="特定于平台的依赖关系" tabindex="-1">特定于平台的依赖关系？ <a class="header-anchor" href="#特定于平台的依赖关系" aria-label="Permalink to &quot;特定于平台的依赖关系？&quot;">​</a></h2><p>Bun 将来自 npm 的标准化 cpu 和 os 值以及解析的包存储在 lockfile 中。它会跳过在运行时对当前目标禁用的下载，提取和安装软件包。这意味着即使最终安装的软件包发生变化，锁定文件也不会在平台/体系结构之间发生变化。</p><h2 id="bun-的锁定文件存储了什么" tabindex="-1">Bun 的锁定文件存储了什么？ <a class="header-anchor" href="#bun-的锁定文件存储了什么" aria-label="Permalink to &quot;Bun 的锁定文件存储了什么？&quot;">​</a></h2><p>包、这些包的源数据、提升的安装顺序、每个包的依赖关系、这些依赖关系解析到什么包、完整性散列 (如果可用) 、每个包解析到什么以及哪个版本 (或等效)等。</p><h2 id="为什么-bun-的-lockfile-速度很快" tabindex="-1">为什么 Bun 的 lockfile 速度很快？ <a class="header-anchor" href="#为什么-bun-的-lockfile-速度很快" aria-label="Permalink to &quot;为什么 Bun 的 lockfile 速度很快？&quot;">​</a></h2><p>它对所有数据使用线性数组。<a href="https://github.com/oven-sh/bun/blob/be03fc273a487ac402f19ad897778d74b6d72963/src/install/install.zig#L1825" target="_blank" rel="noreferrer">程序包</a> 由自动递增的整数 ID 或包名称的哈希引用。长度超过 8 个字符的字符串将被消除重复。在保存到磁盘上之前，通过遍历包树并按依赖关系顺序克隆包，对 lockfile 进行垃圾回收并使其具有确定性。</p><h2 id="我可以选择退出吗" tabindex="-1">我可以选择退出吗？ <a class="header-anchor" href="#我可以选择退出吗" aria-label="Permalink to &quot;我可以选择退出吗？&quot;">​</a></h2><p>要在不创建锁定文件的情况下安装，请执行以下操作：</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">bun</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">install</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--no-save</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">bun</span><span style="color:#24292E;"> </span><span style="color:#032F62;">install</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--no-save</span></span></code></pre></div><p>要安装除 bun.lockb 之外的 yarn lockfile 文件。</p><div class="vp-code-group vp-adaptive-theme"><div class="tabs"><input type="radio" name="group-a7Qg9" id="tab-pjuMR5p" checked="checked"><label for="tab-pjuMR5p">CLI 标志</label><input type="radio" name="group-a7Qg9" id="tab-iGm-ztK"><label for="tab-iGm-ztK">bunfig.toml</label></div><div class="blocks"><div class="language-sh vp-adaptive-theme active"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">bun</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">install</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--yarn</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">bun</span><span style="color:#24292E;"> </span><span style="color:#032F62;">install</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--yarn</span></span></code></pre></div><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[install.lockfile]</span></span>
<span class="line"><span style="color:#6A737D;"># 是否将非 bun lockfile 与 bun.lockb一起保存</span></span>
<span class="line"><span style="color:#6A737D;"># 仅支持 “yarn”</span></span>
<span class="line"><span style="color:#79B8FF;">print</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;yarn&quot;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[install.lockfile]</span></span>
<span class="line"><span style="color:#6A737D;"># 是否将非 bun lockfile 与 bun.lockb一起保存</span></span>
<span class="line"><span style="color:#6A737D;"># 仅支持 “yarn”</span></span>
<span class="line"><span style="color:#005CC5;">print</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;yarn&quot;</span></span></code></pre></div></div></div><details class="details custom-block"><summary>配置 lockfile</summary><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[install.lockfile]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 是否将lockfile保存到磁盘</span></span>
<span class="line"><span style="color:#B392F0;">save</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">true</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 是否将非Bun lockfile与bun.lockb一起保存</span></span>
<span class="line"><span style="color:#6A737D;"># 仅支持 “yarn”</span></span>
<span class="line"><span style="color:#79B8FF;">print</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;yarn&quot;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[install.lockfile]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 是否将lockfile保存到磁盘</span></span>
<span class="line"><span style="color:#6F42C1;">save</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">true</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 是否将非Bun lockfile与bun.lockb一起保存</span></span>
<span class="line"><span style="color:#6A737D;"># 仅支持 “yarn”</span></span>
<span class="line"><span style="color:#005CC5;">print</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;yarn&quot;</span></span></code></pre></div></details>`,28),e=[p];function c(t,r,i,y,d,E){return a(),l("div",null,e)}const h=s(o,[["render",c]]);export{b as __pageData,h as default};
